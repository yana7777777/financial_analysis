<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
    <link rel="stylesheet" href="{% static 'css/style3.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'skills/favicon.ico' %}">

    </head>
<body>

<div class="menu">
    <div class="wrap">
        <div class="menu_header">
            {% if user.is_authenticated %}
            <div class="logo">
                <a href="{% url 'index' %}">
                    <img src="{% static 'skills/logo.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="image">
                </a>
            </div>

            <!-- –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
            <div class="burger-menu" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <ul class="menu_total" id="mainMenu">
                <li><a href="{% url 'index' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="{% url 'financial_analysis_page' %}">üìä –§–∏–Ω–∞–Ω—Å—ã</a></li>
                <li><a href="{% url 'blogs' %}">üìù –ë–ª–æ–≥</a></li>
                <li><a href="{% url 'currenttodos' %}">‚úÖ –ó–∞–¥–∞—á–∏</a></li>
<!--                <li><a href="{% url 'createtodo' %}">üÜï –°–æ–∑–¥–∞—Ç—å</a></li>-->
                <li><a href="{% url 'completedtodos' %}">üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</a></li>
                <li><a href="{% url 'trashbin' %}">üóëÔ∏è –ö–æ—Ä–∑–∏–Ω–∞</a></li>
            </ul>

            <ul class="menu_second">
                <li class="logo2">üë§ {{ user.username }}</li>
                <li>
                    <form action="{% url 'logoutuser' %}" method="post">
                        {% csrf_token %}
                        <button class="top">üö™ –í—ã–π—Ç–∏</button>
                    </form>
                </li>
            </ul>
            {% else %}
            <div class="logo">
                <a href="{% url 'index' %}">
                    <img src="{% static 'skills/logo.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="image">
                </a>
            </div>

            <ul class="menu_second">
                <li class="menu_login"><a href="{% url 'signupuser' %}">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></li>
                <li class="menu_login"><a href="{% url 'loginuser' %}">üîë –í–æ–π—Ç–∏</a></li>
            </ul>
            {% endif %}
        </div>
    </div>
</div>

<div class="content">
    <div class="wrap">
        {% block content %}
        {% endblock %}
    </div>
</div>

<script>
    function toggleMenu() {
        const menu = document.getElementById('mainMenu');
        menu.classList.toggle('show');
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ outside
    document.addEventListener('click', function(event) {
        const menu = document.getElementById('mainMenu');
        const burger = document.querySelector('.burger-menu');

        if (!menu.contains(event.target) && !burger.contains(event.target)) {
            menu.classList.remove('show');
        }
    });

    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
function initMenuDragAndDrop() {
    const menuList = document.querySelector('.menu_total');

    if (menuList) {
        new Sortable(menuList, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            chosenClass: 'sortable-chosen',
            dragClass: 'sortable-drag',
            onEnd: function(evt) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –≤ localStorage
                saveMenuOrder();
            }
        });
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–µ–Ω—é
function saveMenuOrder() {
    const menuItems = document.querySelectorAll('.menu_total li');
    const order = Array.from(menuItems).map(item => {
        const link = item.querySelector('a');
        return link ? link.getAttribute('href') : '';
    }).filter(Boolean);

    localStorage.setItem('menuOrder', JSON.stringify(order));
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–µ–Ω—é
function restoreMenuOrder() {
    const savedOrder = localStorage.getItem('menuOrder');
    if (!savedOrder) return;

    const order = JSON.parse(savedOrder);
    const menuList = document.querySelector('.menu_total');
    if (!menuList) return;

    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const itemsMap = {};
    const items = Array.from(menuList.children);

    items.forEach(item => {
        const link = item.querySelector('a');
        if (link) {
            itemsMap[link.getAttribute('href')] = item;
        }
    });

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫
    order.forEach(href => {
        if (itemsMap[href]) {
            menuList.appendChild(itemsMap[href]);
        }
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initMenuDragAndDrop();
    restoreMenuOrder();

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    const menuItems = document.querySelectorAll('.menu_total li');
    menuItems.forEach(item => {
        item.setAttribute('title', '–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞');
        item.style.cursor = 'grab';
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é
function toggleMenu() {
    const menu = document.getElementById('mainMenu');
    menu.classList.toggle('show');
}
</script>
</body>
</html>