{% extends 'skills/base.html' %}

{% block content %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h2 class="mb-0">üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏</h2>
                </div>

                <div class="card-body">
                    {% if error %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>–û—à–∏–±–∫–∞!</strong> {{ error }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endif %}

                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="{{ form.title.id_for_label }}" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label>
                            {{ form.title }}
                            <div class="invalid-feedback">
                                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏.
                            </div>
                        </div>

                        {% if form.description %}
                        <div class="mb-3">
                            <label for="{{ form.description.id_for_label }}" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            {{ form.description }}
                        </div>
                        {% else %}
                        <div class="mb-3">
                            <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                      placeholder="–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..."></textarea>
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <label for="{{ form.important.id_for_label }}" class="form-check-label">
                                {{ form.important }} –í–∞–∂–Ω–∞—è –∑–∞–¥–∞—á–∞
                            </label>
                        </div>

                        {% if form.deadline %}
                        <div class="mb-3">
                            <label for="{{ form.deadline.id_for_label }}" class="form-label">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                            {{ form.deadline }}
                            <small class="form-text text-muted">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</small>
                        </div>
                        {% else %}
                        <div class="mb-3">
                            <label for="deadline" class="form-label">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                            <input type="datetime-local" class="form-control" id="deadline" name="deadline">
                            <small class="form-text text-muted">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</small>
                        </div>
                        {% endif %}

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                ‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                            <a href="{% url 'currenttodos' %}" class="btn btn-outline-secondary">
                                ‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
(function () {
    'use strict'

    var forms = document.querySelectorAll('.needs-validation')

    Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }

                form.classList.add('was-validated')
            }, false)
        })
})()

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è deadline (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)
document.addEventListener('DOMContentLoaded', function() {
    const deadlineField = document.getElementById('deadline');
    if (deadlineField) {
        const now = new Date();
        const localDateTime = now.toISOString().slice(0, 16);
        deadlineField.min = localDateTime;
    }
});
</script>

{% endblock %}